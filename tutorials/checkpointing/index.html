<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tutorial for using the checkpointing technique to manage tape memory with XAD.
"><meta name=author content=Xcelerit><link href=https://auto-differentiation.github.io/tutorials/checkpointing/ rel=canonical><link href=../external_functions/ rel=prev><link href=../higher_order/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.3, mkdocs-material-9.1.15"><title>Checkpointing - XAD</title><link rel=stylesheet href=../../assets/stylesheets/main.26e3688c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ecc896b0.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-FKBZYBC759"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-FKBZYBC759",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-FKBZYBC759",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script><meta property=og:type content=website><meta property=og:title content="Checkpointing - XAD"><meta property=og:description content="Tutorial for using the checkpointing technique to manage tape memory with XAD.
"><meta property=og:image content=https://auto-differentiation.github.io/assets/images/social/tutorials/checkpointing.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://auto-differentiation.github.io/tutorials/checkpointing/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Checkpointing - XAD"><meta name=twitter:description content="Tutorial for using the checkpointing technique to manage tape memory with XAD.
"><meta name=twitter:image content=https://auto-differentiation.github.io/assets/images/social/tutorials/checkpointing.png><link rel=apple-touch-icon sizes=180x180 href=/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><link rel=manifest href=/favicon/site.webmanifest><link rel=mask-icon href=/favicon/safari-pinned-tab.svg color=#5bbad5><link rel="shortcut icon" href=/favicon/favicon.ico><meta name=msapplication-TileColor content=#ffc40d><meta name=msapplication-config content=/favicon/browserconfig.xml></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=amber> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#checkpointing class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=XAD class="md-header__button md-logo" aria-label=XAD data-md-component=logo> <img src=../../images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> XAD </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Checkpointing </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=amber aria-hidden=true type=radio name=__palette id=__palette_1> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/auto-differentiation/XAD/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> XAD </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting_started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../basic/ class="md-tabs__link md-tabs__link--active"> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../ref/headers/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../examples/ class=md-tabs__link> Examples </a> </li> <li class=md-tabs__item> <a href=../../aad/ class=md-tabs__link> AD Background </a> </li> <li class=md-tabs__item> <a href=../../quantlib/ class=md-tabs__link> QuantLib Integration </a> </li> <li class=md-tabs__item> <a href=../../about/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=XAD class="md-nav__button md-logo" aria-label=XAD data-md-component=logo> <img src=../../images/logo.svg alt=logo> </a> XAD </label> <div class=md-nav__source> <a href=https://github.com/auto-differentiation/XAD/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> XAD </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../getting_started/ class=md-nav__link> Getting Started </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../basic/ class=md-nav__link> Basic Usage </a> </li> <li class=md-nav__item> <a href=../external_functions/ class=md-nav__link> External Functions </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Checkpointing <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Checkpointing </a> <nav class="md-nav md-nav--secondary" aria-label=Contents> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-algorithm class=md-nav__link> Example Algorithm </a> </li> <li class=md-nav__item> <a href=#checkpoint-callback class=md-nav__link> Checkpoint Callback </a> <nav class=md-nav aria-label="Checkpoint Callback"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#computestage-method class=md-nav__link> computeStage Method </a> </li> <li class=md-nav__item> <a href=#computeadjoint-method class=md-nav__link> computeAdjoint Method </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#call-site class=md-nav__link> Call-Site </a> </li> <li class=md-nav__item> <a href=#other-usage-patterns class=md-nav__link> Other Usage Patterns </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../higher_order/ class=md-nav__link> Higher-Order Derivatives </a> </li> <li class=md-nav__item> <a href=../smoothed_math/ class=md-nav__link> Handling Discontinuities </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ref/headers/ class=md-nav__link> Headers and Namespaces </a> </li> <li class=md-nav__item> <a href=../../ref/interface/ class=md-nav__link> AD Mode Interface </a> </li> <li class=md-nav__item> <a href=../../ref/freal/ class=md-nav__link> Forward Mode Type FReal </a> </li> <li class=md-nav__item> <a href=../../ref/areal/ class=md-nav__link> Adjoint Mode Type AReal </a> </li> <li class=md-nav__item> <a href=../../ref/global/ class=md-nav__link> Global Functions </a> </li> <li class=md-nav__item> <a href=../../ref/math/ class=md-nav__link> Mathematical Operations </a> </li> <li class=md-nav__item> <a href=../../ref/complex/ class=md-nav__link> Complex </a> </li> <li class=md-nav__item> <a href=../../ref/smooth-math/ class=md-nav__link> Smoothed Mathematical Functions </a> </li> <li class=md-nav__item> <a href=../../ref/expressions/ class=md-nav__link> Expressions </a> </li> <li class=md-nav__item> <a href=../../ref/tape/ class=md-nav__link> Tape </a> </li> <li class=md-nav__item> <a href=../../ref/chkpt_cb/ class=md-nav__link> CheckpointCallback </a> </li> <li class=md-nav__item> <a href=../../ref/exceptions/ class=md-nav__link> Exceptions </a> </li> <li class=md-nav__item> <a href=../../ref/version/ class=md-nav__link> Version Information </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../examples/ class=md-nav__link> Examples </a> </li> <li class=md-nav__item> <a href=../../aad/ class=md-nav__link> AD Background </a> </li> <li class=md-nav__item> <a href=../../quantlib/ class=md-nav__link> QuantLib Integration </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> About </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=Contents> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#example-algorithm class=md-nav__link> Example Algorithm </a> </li> <li class=md-nav__item> <a href=#checkpoint-callback class=md-nav__link> Checkpoint Callback </a> <nav class=md-nav aria-label="Checkpoint Callback"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#computestage-method class=md-nav__link> computeStage Method </a> </li> <li class=md-nav__item> <a href=#computeadjoint-method class=md-nav__link> computeAdjoint Method </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#call-site class=md-nav__link> Call-Site </a> </li> <li class=md-nav__item> <a href=#other-usage-patterns class=md-nav__link> Other Usage Patterns </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=checkpointing>Checkpointing<a class=headerlink href=#checkpointing title="Permanent link">&para;</a></h1> <p>Checkpointing is a technique to reduce the memory footprint of the tape in adjoint mode algorithmic differentiation. Instead of recording the full algorithm on tape, which can quickly result in gigabytes of memory in a large computation, the tape is recorded for specific stages of the algorithm, one at a time. This is illustrated in the following figure:</p> <p><img alt=Checkpointing src=../../images/checkpointing.svg></p> <p>The algorithm is divided into stages, where the input data of each stage is stored in a checkpoint and the outputs are computed passively (without recording on tape). Once the final output of the algorithm is computed, the adjoint of the output is initialized and at each checkpoint during tape rollback:</p> <ol> <li>The inputs to the checkpoint are loaded,</li> <li>The operations of this stage only are recorded on tape,</li> <li>The output adjoints of this stage are initialized,</li> <li>The tape is rolled back for this stage, computing the adjoints of the stage inputs,</li> <li>The input adjoints are incremented by these values, and</li> <li>The tape is wiped before proceeding with the previous stage.</li> </ol> <p>Using this method, the tape memory is limited by the amount needed to record one algorithm stage instead of the full algorithm. However, each forward computation is computed twice, hence checkpointing trades computation for memory.</p> <p>In practice, as using less memory leads to higher cache-efficiency, checkpointing may be faster overall than recording the full algorithm even though more computations are performed.</p> <h2 id=example-algorithm>Example Algorithm<a class=headerlink href=#example-algorithm title="Permanent link">&para;</a></h2> <p>To demonstrate the checkpointing method, we choose a simple repeated application of the sine function to a single input:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>T</span><span class=o>&gt;</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kt>void</span><span class=w> </span><span class=n>repeated_sin</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>T</span><span class=o>&amp;</span><span class=w> </span><span class=n>x</span><span class=p>)</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=p>{</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=p>)</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sin</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>}</span>
</code></pre></div> <p>We divide the for loop into equidistant stages and insert a checkpoint at each of these.</p> <h2 id=checkpoint-callback>Checkpoint Callback<a class=headerlink href=#checkpoint-callback title="Permanent link">&para;</a></h2> <p>To create a checkpoint, we need to store the inputs of the stage and the slots in the tape for the inputs and outputs in a callback object inheriting from <a href=../../ref/chkpt_cb/#checkpointcallback><code>CheckpointCallback</code></a>. The virtual method <a href=../../ref/chkpt_cb/#computeadjoint><code>CheckpointCallback::computeAdjoint</code></a> needs to be overridden to perform the per-stage adjoint computation. As all stages are identical, we choose to implement the functionality of all checkpoints within a single callback object and store the required inputs in a stack data structure. Alternatively we could have created a new checkpoint callback object at every checkpoint. The prototype for our callback is:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>class</span><span class=w> </span><span class=nc>Tape</span><span class=o>&gt;</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>class</span><span class=w> </span><span class=nc>SinCheckpointCallback</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>public</span><span class=w> </span><span class=n>xad</span><span class=o>::</span><span class=n>CheckpointCallback</span><span class=o>&lt;</span><span class=n>Tape</span><span class=o>&gt;</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=p>{</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>public</span><span class=o>:</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=k>typedef</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>Tape</span><span class=o>::</span><span class=n>slot_type</span><span class=w>   </span><span class=n>slot_type</span><span class=p>;</span><span class=w>   </span><span class=c1>// type for slot in the tape</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=k>typedef</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>Tape</span><span class=o>::</span><span class=n>value_type</span><span class=w>  </span><span class=n>value_type</span><span class=p>;</span><span class=w>  </span><span class=c1>// double</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=k>typedef</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>Tape</span><span class=o>::</span><span class=n>active_type</span><span class=w> </span><span class=n>active_type</span><span class=p>;</span><span class=w> </span><span class=c1>// AReal&lt;double&gt;</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>active_type</span><span class=w> </span><span class=nf>computeStage</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>active_type</span><span class=o>&amp;</span><span class=w> </span><span class=n>x</span><span class=p>);</span><span class=w> </span><span class=c1>// forward computation</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>computeAdjoint</span><span class=p>(</span><span class=n>Tape</span><span class=o>*</span><span class=w> </span><span class=n>tape</span><span class=p>)</span><span class=w> </span><span class=k>override</span><span class=p>;</span><span class=w>        </span><span class=c1>// adjoint computation</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=k>private</span><span class=o>:</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>stack</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>n_</span><span class=p>;</span><span class=w>                    </span><span class=c1>// number of iterations in this stage</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>stack</span><span class=o>&lt;</span><span class=n>value_type</span><span class=o>&gt;</span><span class=w> </span><span class=n>x_</span><span class=p>;</span><span class=w>             </span><span class=c1>// input values for this stage</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>stack</span><span class=o>&lt;</span><span class=n>slot_type</span><span class=o>&gt;</span><span class=w> </span><span class=n>slots_</span><span class=p>;</span><span class=w>          </span><span class=c1>// tape slots for input and output</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=p>};</span>
</code></pre></div> <p>For convenience of implementation, we added the forward computation for one stage within the same class in the <code>computeStage</code> method, which could also be performed outside of the object.</p> <h3 id=computestage-method><code>computeStage</code> Method<a class=headerlink href=#computestage-method title="Permanent link">&para;</a></h3> <p>Within the <code>computeStage</code> method, we first store the input value, the number of iterations, and the slots of the input in the checkpoint object:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>n_</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>n</span><span class=p>);</span>
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>slots_</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>getSlot</span><span class=p>());</span>
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=n>value_type</span><span class=w> </span><span class=n>x_p</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>value</span><span class=p>(</span><span class=n>x</span><span class=p>);</span>
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>x_</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x_p</span><span class=p>);</span>
</code></pre></div> <p>We then compute the stage with the passive variable (not recording on the tape):</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>repeated_sin</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>x_p</span><span class=p>);</span>
</code></pre></div> <p>The value of the output active variable needs to be updated with the result and we need to store the slot of the output variable in the checkpoint also:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>value</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x_p</span><span class=p>;</span>
<a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>slots_</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>x</span><span class=p>.</span><span class=n>getSlot</span><span class=p>());</span>
</code></pre></div> <p>Note that we did not need to register <code>x</code> as an output with the tape here, as we had to do with the external functions example before, since the variable is already registered on tape (it's both input and output).</p> <p>What is left is to register this callback object with the tape so that its <code>computeAdjoint</code> method is called at this point when the tape is rolled back:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=n>Tape</span><span class=o>::</span><span class=n>getActive</span><span class=p>()</span><span class=o>-&gt;</span><span class=n>insertCallback</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</code></pre></div> <h3 id=computeadjoint-method><code>computeAdjoint</code> Method<a class=headerlink href=#computeadjoint-method title="Permanent link">&para;</a></h3> <p>The <code>computeAdjoint</code> method is called automatically by XAD at the checkpoints in the tape. We first need to load the inputs to this computation stage and obtain the adjoint of the output:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>slot_type</span><span class=w> </span><span class=n>outputidx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>slots_</span><span class=p>.</span><span class=n>top</span><span class=p>();</span><span class=w>  </span><span class=n>slots_</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>slot_type</span><span class=w> </span><span class=n>inputidx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>slots_</span><span class=p>.</span><span class=n>top</span><span class=p>();</span><span class=w>   </span><span class=n>slots_</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>n_</span><span class=p>.</span><span class=n>top</span><span class=p>();</span><span class=w>                    </span><span class=n>n_</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
<a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=n>value_type</span><span class=w> </span><span class=n>outputadj</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tape</span><span class=o>-&gt;</span><span class=n>getAndResetOutputAdjoint</span><span class=p>(</span><span class=n>outputslot</span><span class=p>);</span>
</code></pre></div> <p>The function <a href=../../ref/tape/#getandresetoutputadjoint><code>Tape::getAndResetOutputAdjoint</code></a> reads the adjoint corresponding to the slot given and resets it to 0. This reset is generally required as the variable corresponding to the slot may be re-used (overwritten) in the algorithm, as is the case in the <code>repeated_sin</code> function.</p> <p>We now want to use XAD to compute the adjoints just for this computation stage. This is performed by creating a nested recording within the global tape, than can be rolled back individually:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>active_type</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x_</span><span class=p>.</span><span class=n>top</span><span class=p>();</span><span class=w>               </span><span class=c1>// local independent variable</span>
<a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>x_</span><span class=p>.</span><span class=n>pop</span><span class=p>();</span>
<a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>tape</span><span class=o>-&gt;</span><span class=n>registerInput</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w>                 </span><span class=c1>// need to register to record</span>
<a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
<a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=n>xad</span><span class=o>::</span><span class=n>ScopedNestedRecording</span><span class=o>&lt;</span><span class=n>Tape</span><span class=o>&gt;</span><span class=w> </span><span class=n>nested</span><span class=p>(</span><span class=n>tape</span><span class=p>);</span><span class=w>  </span><span class=c1>// nested recording</span>
<a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=n>repeated_sin</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=w> </span><span class=n>x_ad</span><span class=p>);</span><span class=w>                  </span><span class=c1>// run actively</span>
<a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=n>tape</span><span class=o>-&gt;</span><span class=n>registerOutput</span><span class=p>(</span><span class=n>x</span><span class=p>);</span><span class=w>                </span><span class=c1>// register x as an output</span>
<a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=n>derivative</span><span class=p>(</span><span class=n>x</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>output_adj</span><span class=p>;</span><span class=w>             </span><span class=c1>// set output adjoint</span>
<a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=n>nested</span><span class=p>.</span><span class=n>computeAdjoints</span><span class=p>();</span><span class=w>               </span><span class=c1>// rollback nested tape</span>
<a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
<a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=n>nested</span><span class=p>.</span><span class=n>incrementAdjoint</span><span class=p>(</span><span class=n>inputslot</span><span class=p>,</span><span class=w> </span><span class=n>derivative</span><span class=p>(</span><span class=n>x</span><span class=p>));</span><span class=w>  </span><span class=c1>// incr. input adjoint</span>
</code></pre></div> <p>In a similar fashion to simple adjoint mode (see <a href=../basic/#adjoint-mode>Basic Usage</a>), we first initialize the local independent variables as active data types and start a nested recording. This is performed by creating a local object <code>nested</code> of type <a href=../../ref/tape/#scopednestedrecording><code>ScopedNestedRecording</code></a>, which wraps calls to <a href=../../ref/tape/#newnestedrecording><code>Tape::newNestedRecording</code></a> in its constructor and <a href=../../ref/tape/#endnestedrecording><code>Tape::endNestedRecording</code></a> in its destructor. It is recommended to use the <a href=../../ref/tape/#scopednestedrecording><code>ScopedNestedRecording</code></a> for this purpose to make sure the nested recording is always finished when the scope is left.</p> <p>Next we record the operations for this stage by running the algorithm actively. We then set the adjoint of the output and compute the adjoints of the inputs. The adjoints of the inputs to this stage can then be incremented.</p> <p>Note that when the <code>nested</code> object goes out of scope, i.e. when its destructor is called, the nested tape for this computation stage is wiped and the memory can be reused for the previous stage. This saves overall memory.</p> <h2 id=call-site>Call-Site<a class=headerlink href=#call-site title="Permanent link">&para;</a></h2> <p>The full algorithm with checkpointing can then be initiated as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>tape_type</span><span class=w> </span><span class=n>tape</span><span class=p>;</span>
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=n>AD</span><span class=w> </span><span class=n>x_ad</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w>                             </span><span class=c1>// initialized indepedent variables</span>
<a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=n>tape</span><span class=p>.</span><span class=n>registerInput</span><span class=p>(</span><span class=n>x_ad</span><span class=p>);</span><span class=w>                </span><span class=c1>// register with the tape</span>
<a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=n>tape</span><span class=p>.</span><span class=n>newRecording</span><span class=p>();</span><span class=w>                     </span><span class=c1>// start recording derivatives</span>
<a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=n>SinCheckpointCallback</span><span class=o>&lt;</span><span class=n>tape_type</span><span class=o>&gt;</span><span class=w> </span><span class=n>chkpt</span><span class=p>;</span><span class=w>  </span><span class=c1>// setup checkpointing object</span>
<a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>
<a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=kt>int</span><span class=w> </span><span class=n>checkpt_distance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span><span class=p>;</span><span class=w>                </span><span class=c1>// we checkpoint every 4 iterations</span>
<a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>checkpt_distance</span><span class=p>)</span>
<a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=p>{</span>
<a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>min</span><span class=p>(</span><span class=n>checkpt_distance</span><span class=p>,</span><span class=w> </span><span class=n>n</span><span class=o>-</span><span class=n>i</span><span class=p>);</span>
<a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=w>    </span><span class=n>chkpt</span><span class=p>.</span><span class=n>computeStage</span><span class=p>(</span><span class=n>m</span><span class=p>,</span><span class=w> </span><span class=n>x_ad</span><span class=p>);</span><span class=w>             </span><span class=c1>// one computation stage</span>
<a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=p>}</span>
<a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>
<a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=n>tape</span><span class=p>.</span><span class=n>registerOutput</span><span class=p>(</span><span class=n>x_ad</span><span class=p>);</span>
<a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=n>derivative</span><span class=p>(</span><span class=n>x_ad</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1.0</span><span class=p>;</span>
<a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=n>tape</span><span class=p>.</span><span class=n>computeAdjoints</span><span class=p>();</span>
<a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>
<a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=n>std</span><span class=o>::</span><span class=n>cout</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;xout       = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>value</span><span class=p>(</span><span class=n>x_ad</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>&quot;</span>
<a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=w>          </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;dxout/dxin = &quot;</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>derivative</span><span class=p>(</span><span class=n>x_ad</span><span class=p>)</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=s>&quot;</span><span class=se>\n</span><span class=s>&quot;</span><span class=p>;</span>
</code></pre></div> <p>This follows largely the same procedure as given in <a href=../basic/#adjoint-mode>Basic Usage</a>, but setting up the checkpoint object and calling its <code>computeStage</code> member for every stage of the algorithm (4 iterations in this example).</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>It is important that the checkpoint callback object is valid when <a href=../../ref/tape/#computeadjoints><code>Tape::computeAdjoints</code></a> is called. It should not be destroyed before.</p> </div> <p>See <a href=../../ref/tape/#checkpoint-callback-memory-management>Checkpoint Callback Memory Management</a> for how to use tape-based destruction with dynamically allocated checkpoint callbacks.</p> <div class="admonition note"> <p class=admonition-title>See also</p> <p>This example is included with XAD (<a href=https://github.com/auto-differentiation/XAD/tree/main/samples/checkpointing><code>checkpointing</code></a>).</p> </div> <h2 id=other-usage-patterns>Other Usage Patterns<a class=headerlink href=#other-usage-patterns title="Permanent link">&para;</a></h2> <p>Alternative methods may be used to update the adjoints within a checkpoint's <a href=../../ref/chkpt_cb/#computeadjoint><code>CheckpointCallback::computeAdjoint</code></a> method, such as:</p> <ul> <li>Forward mode algorithmic differentiation within an outer adjoint mode</li> <li>Finite differences (bumping)</li> <li>Analytic derivatives</li> <li>External library functions (see <a href=../external_functions/ >External Functions</a>)</li> </ul> <p>Checkpointing can also be used recursively, i.e., new checkpoints are created within a nested tape in a checkpoint.</p> <p>The benefits of each of these approaches are highly application-dependent.</p> </article> </div> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../external_functions/ class="md-footer__link md-footer__link--prev" aria-label="Previous: External Functions" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> External Functions </div> </div> </a> <a href=../higher_order/ class="md-footer__link md-footer__link--next" aria-label="Next: Higher-Order Derivatives" rel=next> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Higher-Order Derivatives </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2010-2023, Xcelerit Computing Ltd | <a href=#__consent>Cookie settings</a> </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script> <script id=__config type=application/json>{"base": "../..", "features": ["toc.follow", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "navigation.sections", "search.highlight", "search.share", "search.suggest"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": "v1.2.0"}</script> <script src=../../assets/javascripts/bundle.b4d07000.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js></script> </body> </html>